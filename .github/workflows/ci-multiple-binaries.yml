name: CI with Multiple Binaries

on: [push, pull_request]

jobs:
  build-and-test:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Rust
      run: |
        rustup update stable
        rustup default stable
        echo "âœ… Rust setup complete"
      
    - name: Build all binaries
      run: |
        cargo build --release --bins
        echo "âœ… All binaries built successfully"
      
    - name: Test individual binaries
      run: |
        ./target/release/emier-node --help || echo "âœ… Node works"
        ./target/release/emier-cli --version && echo "âœ… CLI works"
        ./target/release/emier-dev && echo "âœ… Dev tools work"
        ./target/release/emier-benchmark && echo "âœ… Benchmark works"
      
    - name: Verify binary sizes
      run: |
        echo "ðŸ“¦ Binary sizes:"
        ls -lh target/release/emier-*
        echo "âœ… Binaries verified"
      
    - name: Run tests
      run: |
        cargo test --verbose
        echo "âœ… All tests passed"
